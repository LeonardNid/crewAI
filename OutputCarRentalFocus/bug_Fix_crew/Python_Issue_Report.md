# Python Issue Report

| #  | File & location                      | Failing request                                 | Root cause                                                                                                        | Suggested fix                                                                                                 |
|----|------------------------------------|------------------------------------------------|-----------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------|
| 1  | app.py: `rentals` POST route       | POST `/rentals` with total_price discrepancy  | The provided test response shows total_price as "249.95" but input calculation (`49.99 * 4 days = 199.96`) mismatch. The code calculates: rental_days = (end_dt - start_dt).days + 1 = 5 days and price_per_day = 49.99, so total_price = 249.95 (correct). The test input uses end_date "2024-07-05" which gives 5 days rental, but total_price sent in request JSON is 199.96 (wrong, 4 days). Test likely sends wrong total_price or the backend assumes inclusive days but test considers exclusive days. | Adjust test to ensure total_price input matches calculation of total_days = inclusive count (days + 1), or adjust test input dates/days consistently. Backend logic matches standard inclusive rental day calculation, so no backend fix needed. |
| 2  | app.py: `rentals` POST route       | POST `/rentals` response returns total_price  | The response JSON shows total_price as string `"249.95"` (quoted) whereas test expects a JSON number possibly. Similarly for `price_per_day` fields in Car responses returned as strings ("49.99"). This happens because `price_per_day` and `total_price` use `Numeric` type from SQLAlchemy which serializes to string by default, causing minor mismatch between expected number and string. | Implement custom JSON encoder or convert `price_per_day` and `total_price` to float in the `.to_dict()` methods to ensure numeric JSON values returned instead of strings. For example, `float(self.price_per_day)`. |
| 3  | app.py: `rentals` PUT route        | PUT `/rentals/1` updates total_price incorrectly | Same numeric serialization issue as above for `total_price` and `price_per_day` fields returned as strings that cause test failures expecting number. | Same fix as above, convert Decimal/Numeric fields to float before JSON response. Also, PUT route updates status and sets car.status conditionally; it sets car.status to 'rented' if rental.status in ['rented', 'booked', 'reserved'] else to 'available', but this logic applies only if 'status' in data and checks obj.status (updated). This is correct but carefully verify. |
| 4  | app.py: DELETE `/rentals/<id>`     | DELETE returns 400 if rental started            | The deletion of rental after start date returns 400 with message "Cannot cancel rental after start date". This is expected behavior. Test confirms it returns 400. No failure here. | No fix needed; this behavior is as designed. Possibly test expecting 400.                                       |
| 5  | app.py: `rentals_int_id_return`    | POST `/rentals/1/return` updates status total_price | Rental return sets status to 'completed' and car.status to 'available' but does not update total_price, so total_price remains unchanged. Test response shows total_price `"249.95"` (string). No mismatch in logic but serialization as strings again. | Fix serialization of total_price by converting to float before jsonify response to match test expectations. |
| 6  | app.py: `cars` POST, PUT           | POST/PUT `/cars` returns price_per_day as string | Related price_per_day field in response is string instead of float causes mismatch with test expectation of number. | Convert price_per_day to float in Car.to_dict() method.                                                       |
| 7  | app.py: `locations` POST, PUT      | POST/PUT `/locations` OK                        | Responses match expected output well. No failure.                                                              | No fix needed.                                                                                                |
| 8  | app.py: `customers` POST, PUT      | POST/PUT `/customers` OK                        | Responses match expected output well. No failure.                                                              | No fix needed.                                                                                                |

### Summary of primary fixes needed:
- Change all `.to_dict()` methods of models that have `price_per_day` (Car) and `total_price` (Rental) numeric fields to convert `Decimal`/`Numeric` to float to avoid numeric values being serialized as strings.
- Clarify rental day count in test or docs: backend logic counts rental days inclusive (end_date - start_date + 1), so ensure test data total_price matches that calculation.
- No backend logic bugs detected causing request failures, only serialization and minor test data mismatch issues.

---

This report diagnoses root causes and actionable fixes for each observed failing test.