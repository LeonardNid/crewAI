# Python Issue Report

| #  | File & location                                    | Failing request                           | Root cause                                                                                                                                            | Suggested fix                                                                                                                                                                                                                                               |
|-----|---------------------------------------------------|------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 1   | models.py: `Thesis` model, line approx 32-63      | All requests (e.g. POST /users, /theses) | `InvalidRequestError`: Mapper 'Thesis' has no property 'user' - indicating a relationship issue between `Thesis` and `User`.                         | The `Thesis` model declares `user` relationship (`back_populates='theses'`) and `user_id` FK but the `User` model defines `theses` relationship with `foreign_keys='[Thesis.user_id]'` as a string instead of a evaluated list of columns, which likely breaks mapping. Correct the `foreign_keys` argument in `User.theses` relationship to be a proper list of column references: replace `foreign_keys='[Thesis.user_id]'` with `foreign_keys=[Thesis.user_id]`. This ensures SQLAlchemy can link the relationship correctly.  |
| 2   | models.py: `User` model, line approx 7-29          | All requests                             | The `User` model's `theses` relationship uses a string `'[Thesis.user_id]'` for `foreign_keys` instead of a direct list referencing the column.       | Change: `foreign_keys='[Thesis.user_id]'` to `foreign_keys=[Thesis.user_id]`. This fixes the mapper initialization problem due to invalid foreign_keys spec.                                                                                                    |
| 3   | models.py: `MeetingNote` model, line approx 94-112 | POST /theses/1/meeting_notes and related | In `MeetingNote`, `user` relationship uses `back_populates='meetingnotes'` while `User` model's `meetingnotes` relationship is correct.               | `MeetingNote` user relationship uses `back_populates='meetingnotes'`, but on `User` the relationship is named `meetingnotes`. This appears consistent, so no immediate fix needed here, the main mapper init error relates to the Thesis-User foreign key. Ensure all relationships use proper foreign_keys references if needed. |
| 4   | models.py: `SupervisorAssignment` model, line approx 68-87 | POST /theses/1/supervisors and related   | Relationship setup looks consistent; no direct mapping problem reported, likely impacted by main Thesis-User relationship error.                      | After fixing the main Thesis-User relationship, this model should work correctly. Verify all `foreign_keys` are properly declared.                                                                                                                        |
| 5   | models.py: `NotificationSettings` model, line approx 114-132 | PUT /users/1/notification_settings        | `NotificationSettings` relationship to `User` uses `back_populates='notificationsettings'` matching with User model. Relationship looks correct.       | No direct issue here tied to the reported mapper error, but confirm lazy loading styles and cascading options are consistent.                                                                                                                               |
| 6   | app.py: Initialization and `db.init_app(app)` at line approx 10-14 | All requests                              | The mapper error states "If this property was indicated from other mappers or configure events, ensure registry.configure() has been called."          | Confirm that `db.create_all()` is called inside app context before any queries. This is done in `app.py` main block. No change needed here, but will only succeed if models are correct.                                                                      |
| 7   | app.py: User creation route `/users` (line approx 18-31)             | POST /users                               | Failed due to invalid mapper initialization because of broken ORM mapping between User and Thesis models.                                             | Fixing the main foreign_keys declaration between `User` and `Thesis` will allow user creation to succeed.                                                                                                                                                    |
| 8   | app.py: Thesis creation route `/theses` POST (line approx 123-134)   | POST /theses                             | Same as above; attempts to create Thesis fails as the mapping for `user` property in Thesis is broken.                                                 | See main fix in models.py ForeignKeys and relationships for `Thesis.user` vs `User.theses`.                                                                                                                                                                  |
| 9   | Any route accessing `Thesis.user` or `User.theses` relationship       | Nearly all CRUD routes for Users and Theses | The root cause for all route failures across many endpoints is the mapper initialization failure from the broken relationship described above.         | Rectify the foreign_keys argument from string to list of columns in `User.theses` and ensure it matches `Thesis.user_id` FK, then re-run `db.create_all()` or database migrations accordingly.                                                               |

---

### Summary of Root Causes:

- The critical issue is the incorrect declaration of the `foreign_keys` argument in the `User.theses` relationship that breaks the mapper initialization in SQLAlchemy.
- This causes cascading mapping failures for all routes involving User and Thesis models since they are linked.
- The error message explicitly references `Mapper 'Thesis' has no property 'user'`, indicating a relationship inconsistency that prevents mapper setup.

### Summary of Suggested Fixes:

- In `models.py` inside class `User`:
  - Change the `theses` relationship's `foreign_keys` argument from a string `'[Thesis.user_id]'` to a list of SQLAlchemy columns `[Thesis.user_id]`.
  - This ensures that SQLAlchemy can correctly link the `User` and `Thesis` models by the foreign key.
- Verify that all relationships using `foreign_keys` use proper column references, not string literals.
- Once this fix is applied, restart the app, ensure `db.create_all()` or migration is run to initialize the db schema if new.
- Test routes again; all SQLAlchemy mapper issues should be resolved allowing successful CRUD operations on Users and Theses.

This fix will address failures across all failed requests listed, covering user creation, login, thesis CRUD, and all related dependent endpoints.

# End of Python Issue Report